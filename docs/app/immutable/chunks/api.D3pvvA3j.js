import{I as R,K as U,R as A,n as E,ap as N,q as V,V as M}from"./utils.BHoosnMm.js";import{w as p}from"./index.8bhIGfqS.js";function q(e,t,...o){var i=e,n=E,a;R(()=>{n!==(n=t())&&(a&&(N(a),a=null),a=A(()=>n(i,...o)))},U),V&&(i=M)}let u="http://0.0.0.0:3000/";async function F(){let e=await fetch("./ip");return e.ok?(u=await e.text(),!0):!1}/*! typescript-cookie v1.0.6 | MIT */const C=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),$=e=>encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),m=decodeURIComponent,h=e=>(e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent));function B(e){return e=Object.assign({},e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires!=null&&(e.expires=e.expires.toUTCString()),Object.entries(e).filter(([t,o])=>o!=null&&o!==!1).map(([t,o])=>o===!0?`; ${t}`:`; ${t}=${o.split(";")[0]}`).join("")}function x(e,t,o){const i=/(?:^|; )([^=]*)=([^;]*)/g,n={};let a;for(;(a=i.exec(document.cookie))!=null;)try{const l=o(a[1]);if(n[l]=t(a[2],l),e===l)break}catch{}return e!=null?n[e]:n}const k=Object.freeze({decodeName:m,decodeValue:h,encodeName:C,encodeValue:$}),y=Object.freeze({path:"/"});function v(e,t,o=y,{encodeValue:i=$,encodeName:n=C}={}){return document.cookie=`${n(e)}=${i(t,e)}${B(o)}`}function O(e,{decodeValue:t=h,decodeName:o=m}={}){return x(e,t,o)}function P({decodeValue:e=h,decodeName:t=m}={}){return x(void 0,e,t)}function b(e,t=y){v(e,"",Object.assign({},t,{expires:-1}))}function g(e,t){const o={set:function(n,a,l){return v(n,a,Object.assign({},this.attributes,l),{encodeValue:this.converter.write})},get:function(n){if(arguments.length===0)return P(this.converter.read);if(n!=null)return O(n,this.converter.read)},remove:function(n,a){b(n,Object.assign({},this.attributes,a))},withAttributes:function(n){return g(this.converter,Object.assign({},this.attributes,n))},withConverter:function(n){return g(Object.assign({},this.converter,n),this.attributes)}},i={attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}};return Object.create(o,i)}g({read:k.decodeValue,write:k.encodeValue},y);function G(e){let t=e,o=t%60,i=o>0?`${o} másodperc`:"";t-=o;let n=Math.floor(t/60)%60,a=n>0?`${n} perc`:"";t-=n*60;let l=Math.floor(t/3600)%24,I=l>0?`${l} óra`:"";t-=l*3600;let d=Math.floor(t/(3600*24)),D=d>0?`${d} nap`:"",T=[D,I,a,i].filter(Boolean).join(" ");return{secs:o,mins:n,hours:l,days:d,secsString:i,minsString:a,hoursString:I,daysString:D,fullString:T}}function w(e){return e.meetingStart+e.meetingLength>_()}function _(){return Math.round(Date.now()/1e3)}let S=p(),r;S.subscribe(e=>{r=e});let s="",f,L=p(Math.floor(Date.now()/1e3)),j=p("");async function J(){await F();let e=O("id");await c(),setInterval(()=>{L.set(Math.floor(Date.now()/1e3))},1e3),e&&(await Y(e,void 0)||(console.log(e),b("id"))),r?f=setInterval(c,5e3):f=setInterval(async()=>{await c(),r&&(clearInterval(f),f=setInterval(c,5e3))},1e3)}async function Y(e,t){return t&&t.preventDefault(),r&&e!=""&&e.length==r.gamedata.idLength?(s=e,await c()?(v("id",e,{expires:365}),!0):(s="",!1)):(c(),!1)}async function c(e){e&&e.preventDefault;let t;return r&&s.length==r.gamedata.idLength?t=await fetch(`${u}players/${s}`):t=await fetch(u+"players"),t.ok&&(S.set(JSON.parse(await t.text())),r.player)?(j.set(r.player.voteID?r.player.voteID:""),!0):!1}async function H(e,t){if(t&&t.preventDefault(),!r||!r.player||!r.player.isKiller)return console.error("You cant kill someone because you are either not logged in or you are not the killer"),!1;w(r.gamedata)&&console.error("You cant kill during a meeting");const o=await fetch(`${u}kill/${e.publicID}`,{method:"POST",body:s});return console.log(await o.text()),o.ok?(console.log("sucesfully killed someone"),!0):(console.error("failed to kill someone"),!1)}async function Q(e){s="",b("id"),c(),console.log("You logged out")}async function W(e,t){if(t&&t.preventDefault(),r&&r.player&&r.player.revealDeath==null&&w(r.gamedata)){const o=await fetch(`${u}vote/${e.publicID}`,{method:"POST",body:s});return console.log(await o.text()),o.ok?(console.log("sucesfully voted for someone"),j.set(e.publicID),!0):(console.log("failed to vote for someone"),!1)}return console.error("You cant vote because you are not logged in or dead"),!1}async function X(e){if(e&&e.preventDefault(),r&&r.player&&r.player.revealDeath==null&&r.player.canCallMeeting>0&&!w(r.gamedata)){const t=await fetch(`${u}meeting`,{method:"POST",body:s});return console.log(await t.text()),t.ok?(console.log("sucesfully voted for someone"),!0):(console.log("failed to vote for someone"),!1)}return console.error("You cant call meeting because you are not logged in or dead or it is already a meeting"),!1}export{G as a,j as b,Y as c,X as d,J as e,S as g,w as i,H as k,Q as l,q as s,L as u,W as v};
