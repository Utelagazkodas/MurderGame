import{E as F,G as M,N as L,T as P,ao as V,l as B,P as _}from"./CR9AOu9j.js";import{w as p,a as Y}from"./CEGhva4W.js";function Z(e,t,...o){var l=e,a=P,r;F(()=>{a!==(a=t())&&(r&&(V(r),r=null),r=L(()=>a(l,...o)))},M),B&&(l=_)}let d="http://0.0.0.0:3000/";async function z(){let e=await fetch("./ip");return e.ok?(d=await e.text(),!0):!1}/*! typescript-cookie v1.0.6 | MIT */const k=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),C=e=>encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),h=decodeURIComponent,y=e=>(e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent));function W(e){return e=Object.assign({},e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires!=null&&(e.expires=e.expires.toUTCString()),Object.entries(e).filter(([t,o])=>o!=null&&o!==!1).map(([t,o])=>o===!0?`; ${t}`:`; ${t}=${o.split(";")[0]}`).join("")}function x(e,t,o){const l=/(?:^|; )([^=]*)=([^;]*)/g,a={};let r;for(;(r=l.exec(document.cookie))!=null;)try{const i=o(r[1]);if(a[i]=t(r[2],i),e===i)break}catch{}return e!=null?a[e]:a}const I=Object.freeze({decodeName:h,decodeValue:y,encodeName:k,encodeValue:C}),w=Object.freeze({path:"/"});function v(e,t,o=w,{encodeValue:l=C,encodeName:a=k}={}){return document.cookie=`${a(e)}=${l(t,e)}${W(o)}`}function O(e,{decodeValue:t=y,decodeName:o=h}={}){return x(e,t,o)}function G({decodeValue:e=y,decodeName:t=h}={}){return x(void 0,e,t)}function b(e,t=w){v(e,"",Object.assign({},t,{expires:-1}))}function m(e,t){const o={set:function(a,r,i){return v(a,r,Object.assign({},this.attributes,i),{encodeValue:this.converter.write})},get:function(a){if(arguments.length===0)return G(this.converter.read);if(a!=null)return O(a,this.converter.read)},remove:function(a,r){b(a,Object.assign({},this.attributes,r))},withAttributes:function(a){return m(this.converter,Object.assign({},this.attributes,a))},withConverter:function(a){return m(Object.assign({},this.converter,a),this.attributes)}},l={attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}};return Object.create(o,l)}m({read:I.decodeValue,write:I.encodeValue},w);function ee(e){let t=e;e<0&&(t=0);let o=t%60,l=o>0?`${o} másodperc`:"";t-=o;let a=Math.floor(t/60)%60,r=a>0?`${a} perc`:"";t-=a*60;let i=Math.floor(t/3600)%24,S=i>0?`${i} óra`:"";t-=i*3600;let u=Math.floor(t/(3600*24)),D=u>0?`${u} nap`:"",U=[D,S,r,l].filter(Boolean).join(" "),R=`${u} n ${i} ó ${a} p ${o} m`;const f=A=>String(A).padStart(2,"0");let E=`${u} nap ${f(i)}:${f(a)}:${f(o)}`,N=`${f(i+u*24)}:${f(a)}:${f(o)}`;return{secs:o,mins:a,hours:i,days:u,secsString:l,minsString:r,hoursString:S,daysString:D,fullString:U,smallString:E,altFullString:R,altSmallString:N}}function $(e){return e.meetingStart+e.meetingLength>J()}function J(){return Math.round(Date.now()/1e3)}function te(e,t){return e||t}let j=p(),n;j.subscribe(e=>{n=e});let c="",g,K=p(Math.floor(Date.now()/1e3)),T=p("");async function oe(){var o;await z();let e=O("id");await s();let t=new URLSearchParams(window.location.search);t.has("id")&&((o=t.get("id"))==null?void 0:o.length)==n.gamedata.idLength&&(e=t.get("id")),H(),e&&(await q(e,void 0)||(console.log(e),b("id"))),setInterval(()=>{K.set(Math.floor(Date.now()/1e3)),Math.floor(Date.now()/1e3)>=n.gamedata.meetingStart+n.gamedata.meetingLength&&s()},1e3),n?g=setInterval(s,5e3):g=setInterval(async()=>{await s(),n&&(clearInterval(g),g=setInterval(s,5e3))},1e3)}async function q(e,t){return t&&t.preventDefault(),n&&e!=""&&e.length==n.gamedata.idLength?(c=e,await s()?(v("id",e,{expires:365}),!0):(c="",!1)):(s(),!1)}async function s(e){e&&e.preventDefault;let t;return n&&c.length==n.gamedata.idLength?t=await fetch(`${d}players/${c}`):t=await fetch(d+"players"),t.ok&&(j.set(JSON.parse(await t.text())),n.player)?(T.set(n.player.voteID?n.player.voteID:""),!0):!1}async function ne(e,t){if(t&&t.preventDefault(),n.gamedata.gameWon!=0)return console.error("you cant kill someone, the game is over"),!1;if(!n||!n.player||!n.player.isKiller)return console.error("You cant kill someone because you are either not logged in or you are not the killer"),!1;$(n.gamedata)&&console.error("You cant kill during a meeting");const o=await fetch(`${d}kill/${e.publicID}`,{method:"POST",body:c});return s(),console.log(await o.text()),o.ok?(console.log("sucesfully killed someone"),!0):(console.error("failed to kill someone"),!1)}async function ae(e){c="",b("id"),s(),console.log("You logged out")}async function re(e,t){if(n.gamedata.gameWon!=0)return console.error("you cant vote, the game is over"),!1;if(t&&t.preventDefault(),n&&n.player&&n.player.revealDeath==null&&$(n.gamedata)){const o=await fetch(`${d}vote/${e.publicID}`,{method:"POST",body:c});return s(),console.log(await o.text()),o.ok?(console.log("sucesfully voted for someone"),T.set(e.publicID),!0):(console.log("failed to vote for someone"),!1)}return console.error("You cant vote because you are not logged in or dead"),!1}async function ie(e){if(n.gamedata.gameWon!=0)return console.error("you cant call meeting, the game is over"),!1;if(e&&e.preventDefault(),n&&n.player&&n.player.revealDeath==null&&n.player.canCallMeeting>0&&!$(n.gamedata)){const t=await fetch(`${d}meeting`,{method:"POST",body:c});return s(),console.log(await t.text()),t.ok?(console.log("sucesfully voted for someone"),!0):(console.log("failed to vote for someone"),!1)}return console.error("You cant call meeting because you are not logged in or dead or it is already a meeting"),!1}function H(){const e=new URL(window.location.href);e.searchParams.delete("id"),Y(e,{})}export{ee as a,T as b,q as c,ie as d,oe as e,te as f,j as g,$ as i,ne as k,ae as l,Z as s,K as u,re as v};
